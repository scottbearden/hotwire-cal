<%= form_with(model: event, class: "w-full max-w-2xl mx-auto") do |form| %>
  <h1 class="text-2xl font-semibold mb-6"><%= event.new_record? ? "Create Event" : "Edit Event" %></h1>

  <% if event.errors.any? %>
    <div class="bg-red-50 border border-red-200 rounded-md p-4 mb-6">
      <h2 class="text-red-800 font-medium"><%= pluralize(event.errors.count, "error") %> prohibited this event from being saved:</h2>
      <ul class="mt-2 text-red-700">
        <% event.errors.each do |error| %>
          <li class="text-sm">â€¢ <%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Title -->
  <div class="mb-4">
    <%= form.label :summary, "Title", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= form.text_field :summary, 
        class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
        placeholder: "Add title" %>
  </div>

  <!-- All Day Toggle -->
  <div class="mb-4">
    <label class="flex items-center">
      <%= form.check_box :all_day, 
          class: "rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",
          onchange: "toggleAllDay(this)" %>
      <span class="ml-2 text-sm text-gray-700">All day</span>
    </label>
  </div>

  <!-- Date and Time -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
    <div>
      <%= form.label :start_time, "Start", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.datetime_local_field :start_time, 
          class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
          id: "start_time_input" %>
    </div>
    <div>
      <%= form.label :end_time, "End", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.datetime_local_field :end_time, 
          class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
          id: "end_time_input" %>
    </div>
  </div>

  <!-- Description -->
  <div class="mb-4">
    <%= form.label :description, class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= form.text_area :description, 
        rows: 3,
        class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
        placeholder: "Add description" %>
  </div>

  <!-- Location -->
  <div class="mb-4">
    <%= form.label :location, class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= form.text_field :location, 
        class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
        placeholder: "Add location" %>
  </div>

  <!-- Calendar Selection -->
  <div class="mb-4">
    <%= form.label :calendar_id, "Calendar", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= form.select :calendar_id, 
        options_from_collection_for_select(@calendars, :id, :name, event.calendar_id),
        { prompt: "Select a calendar" },
        { class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" } %>
  </div>

  <!-- Status -->
  <div class="mb-4">
    <%= form.label :status, class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= form.select :status, 
        [['Confirmed', 'confirmed'], ['Tentative', 'tentative'], ['Cancelled', 'cancelled']],
        { selected: event.status || 'confirmed' },
        { class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" } %>
  </div>

  <!-- Visibility -->
  <div class="mb-6">
    <%= form.label :visibility, class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= form.select :visibility, 
        [['Default', 'default'], ['Public', 'public'], ['Private', 'private']],
        { selected: event.visibility || 'default' },
        { class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" } %>
  </div>

  <!-- Submit Buttons -->
  <div class="flex justify-between items-center">
    <%= link_to "Cancel", event.persisted? ? event : events_path, 
        class: "px-4 py-2 text-gray-600 hover:text-gray-800" %>
    
    <div class="space-x-3">
      <% if event.persisted? %>
        <%= link_to "Delete", event, method: :delete,
            data: { confirm: "Are you sure?" },
            class: "px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500" %>
      <% end %>
      
      <%= form.submit event.new_record? ? "Create Event" : "Update Event", 
          class: "px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    </div>
  </div>
<% end %>

<script>
function toggleAllDay(checkbox) {
  const startInput = document.getElementById('start_time_input');
  const endInput = document.getElementById('end_time_input');
  
  if (checkbox.checked) {
    // Convert to date inputs for all-day events
    startInput.type = 'date';
    endInput.type = 'date';
  } else {
    // Convert back to datetime inputs
    startInput.type = 'datetime-local';
    endInput.type = 'datetime-local';
  }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
  const allDayCheckbox = document.querySelector('input[name="event[all_day]"]');
  if (allDayCheckbox && allDayCheckbox.checked) {
    toggleAllDay(allDayCheckbox);
  }
});
</script>